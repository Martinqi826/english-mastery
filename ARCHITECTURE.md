# 🏗️ 架构决策记录 (Architecture Decision Records)

> 本文档记录项目的重要技术决策、为什么这样选择、以及替代方案的考量。
> 新参与者必须阅读本文档，理解项目的设计哲学。

---

## 📋 决策索引

| ID | 决策 | 日期 | 状态 |
|----|------|------|------|
| ADR-001 | 前端使用原生 HTML/CSS/JS | 2026-02 | ✅ 采纳 |
| ADR-002 | 后端使用 FastAPI + PostgreSQL | 2026-02 | ✅ 采纳 |
| ADR-003 | 部署使用 Vercel + Railway | 2026-02 | ✅ 采纳 |
| ADR-004 | 使用 Notion 极简设计风格 | 2026-02 | ✅ 采纳 |
| ADR-005 | 数据库迁移使用 Alembic | 2026-02 | ✅ 采纳 |
| ADR-006 | AI 内容生成使用 Claude API | 2026-02 | ✅ 采纳 |

---

## ADR-001: 前端使用原生 HTML/CSS/JS

### 背景
项目需要一个前端方案，需要在开发效率、性能、维护成本之间平衡。

### 决策
使用原生 HTML5 + CSS3 + Vanilla JavaScript，不使用 React/Vue 等框架。

### 原因
1. **简单直接** - 无需构建工具，直接部署静态文件
2. **零依赖** - 不会因为框架升级而维护困难
3. **性能最优** - 没有框架运行时开销
4. **学习成本低** - 任何前端开发者都能快速上手
5. **AI 友好** - AI 助手可以直接生成代码，无需处理复杂的状态管理

### 权衡
- ❌ 缺少组件复用机制
- ❌ 缺少状态管理
- ❌ 大型项目可能难以维护

### 替代方案
| 方案 | 优点 | 缺点 | 为何不选 |
|------|------|------|----------|
| React | 组件化、生态丰富 | 构建复杂、学习曲线 | 项目规模不需要 |
| Vue | 简单易学、渐进式 | 需要构建工具 | 增加复杂度 |
| Astro | 静态优先、性能好 | 需要 Node.js 环境 | 验证阶段不需要 |

### 未来考虑
如果项目规模显著增长，可以考虑：
- 迁移到 Vue 3（渐进式采用）
- 或使用 Web Components 实现组件化

---

## ADR-002: 后端使用 FastAPI + PostgreSQL

### 背景
需要一个可靠的后端 API 服务，支持用户认证、数据存储、AI 集成。

### 决策
- **Web 框架**: FastAPI (Python)
- **数据库**: PostgreSQL
- **ORM**: SQLAlchemy 2.0 (异步)

### 原因

**FastAPI**:
1. **高性能** - 异步支持，性能接近 Go/Node.js
2. **类型安全** - Pydantic 自动验证
3. **文档自动生成** - Swagger UI 开箱即用
4. **Python 生态** - AI/ML 库丰富
5. **AI 友好** - Claude 等 AI 对 Python 支持最好

**PostgreSQL**:
1. **可靠稳定** - 企业级数据库
2. **功能丰富** - JSON、全文搜索等
3. **Railway 原生支持** - 一键部署
4. **免费额度** - 适合验证阶段

### 权衡
- ❌ Python 部署比 Go/Rust 占用资源更多
- ❌ 需要异步编程思维

### 替代方案
| 方案 | 优点 | 缺点 | 为何不选 |
|------|------|------|----------|
| Node.js + Express | JS 全栈 | 类型安全差 | Python AI 生态更好 |
| Go + Gin | 高性能、编译快 | AI 库少 | AI 集成不便 |
| Django | 功能全面 | 偏重、异步支持弱 | 太重了 |

---

## ADR-003: 部署使用 Vercel + Railway

### 背景
需要一个低成本、易维护的部署方案，支持快速迭代。

### 决策
- **前端**: Vercel (静态托管)
- **后端**: Railway (PaaS)
- **数据库**: Railway PostgreSQL

### 原因
1. **零成本** - 免费额度足够验证阶段
2. **Git 集成** - 推送即部署
3. **HTTPS 自动** - 无需配置证书
4. **全球 CDN** - Vercel 边缘网络
5. **简单运维** - 无需管理服务器

### 费用结构
```
Vercel:  $0（永久免费，个人使用）
Railway: $5/月免费额度
总计:    $0/月（验证阶段）
```

### 权衡
- ❌ 免费额度有限制
- ❌ 冷启动延迟
- ❌ 无法自定义基础设施

### 扩展路径
```
验证阶段 → 小规模运营 → 规模化
Vercel    → Vercel Pro   → 自建/云厂商
Railway   → Railway Pro  → AWS/腾讯云
```

---

## ADR-004: 使用 Notion 极简设计风格

### 背景
需要确定产品的视觉设计语言，保持一致性。

### 决策
采用 Notion 风格的极简主义设计：
- 黑白灰为主色调
- 无彩色渐变
- 功能优先，去除装饰

### 原因
1. **专业感** - 适合职场英语学习定位
2. **不过时** - 极简设计经久耐用
3. **开发友好** - 样式规范明确，AI 也能遵循
4. **一致性** - 容易保持全站统一

### 设计规范
详见 `DESIGN_GUIDE.md`

### 权衡
- ❌ 可能显得"冷淡"
- ❌ 不适合游戏化场景

---

## ADR-005: 数据库迁移使用 Alembic

### 背景
项目已有注册用户，数据库结构需要安全演进。

### 决策
使用 Alembic 进行数据库版本控制和迁移。

### 原因
1. **数据安全** - 增量迁移，不会丢失数据
2. **版本控制** - 迁移文件纳入 Git
3. **可回滚** - 支持 downgrade
4. **SQLAlchemy 集成** - 无缝配合

### 迁移规则
```python
# ✅ 正确：添加新字段有默认值
op.add_column('users', sa.Column('avatar', sa.String(), nullable=True))

# ❌ 错误：直接删除字段
op.drop_column('users', 'old_field')  # 危险！

# ✅ 正确：先标记废弃，下个版本再删除
# v1: 添加新字段
# v2: 数据迁移
# v3: 删除旧字段
```

---

## ADR-006: AI 内容生成使用 Claude API

### 背景
用户自定义素材功能需要 AI 生成词汇和阅读理解题目。

### 决策
使用 Anthropic Claude API 进行内容生成。

### 原因
1. **质量高** - Claude 在教育内容生成上表现优秀
2. **API 稳定** - Anthropic 服务可靠
3. **成本合理** - 按使用量付费
4. **支持中文** - 中英双语能力强

### 集成方式
```python
# backend/app/services/ai_service.py
async def generate_learning_content(text: str) -> GeneratedContent:
    # 调用 Claude API 生成词汇和题目
    ...
```

### 权衡
- ❌ 需要 API 费用
- ❌ 依赖第三方服务

### 替代方案
| 方案 | 优点 | 缺点 |
|------|------|------|
| OpenAI GPT-4 | 生态成熟 | API 不稳定（国内） |
| 本地模型 | 无 API 费用 | 质量不够、部署复杂 |
| 腾讯混元 | 国内稳定 | 质量待验证 |

---

## 🔮 未来决策待定

### 待讨论
1. **是否引入 Redis** - 缓存和会话管理
2. **是否引入消息队列** - 异步任务处理
3. **是否迁移到微服务** - 规模化后考虑

### 评估标准
做新的技术决策时，请考虑：
1. 是否解决实际问题？
2. 是否增加不必要的复杂度？
3. 团队（包括 AI）是否能维护？
4. 成本是否可接受？

---

## 📝 如何添加新的 ADR

```markdown
## ADR-XXX: 决策标题

### 背景
为什么需要做这个决策？

### 决策
具体选择了什么？

### 原因
为什么这样选择？

### 权衡
这个决策的缺点是什么？

### 替代方案
考虑过哪些其他方案？为什么没选？
```

---

*最后更新: 2026-02-28*
