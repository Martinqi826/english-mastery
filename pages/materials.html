<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘çš„ç´ æ - English Mastery</title>
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    /* ========== é¡µé¢å¸ƒå±€ ========== */
    .materials-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-xl, 40px);
    }
    
    @media (min-width: 1024px) {
      .materials-container {
        grid-template-columns: 400px 1fr;
      }
    }
    
    /* ========== ä¸Šä¼ åŒºåŸŸ ========== */
    .upload-section {
      background: var(--notion-bg, #ffffff);
      border: 1px solid var(--notion-gray-light, #e3e2e0);
      border-radius: 12px;
      padding: var(--spacing-lg, 24px);
    }
    
    .upload-section h2 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--notion-dark, #37352f);
      margin-bottom: var(--spacing-md, 16px);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm, 8px);
    }
    
    /* æ ‡ç­¾åˆ‡æ¢ */
    .upload-tabs {
      display: flex;
      gap: var(--spacing-xs, 4px);
      margin-bottom: var(--spacing-md, 16px);
      border-bottom: 1px solid var(--notion-gray-light, #e3e2e0);
      padding-bottom: var(--spacing-sm, 8px);
    }
    
    .upload-tab {
      padding: var(--spacing-sm, 8px) var(--spacing-md, 16px);
      background: transparent;
      border: none;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--notion-gray, #9b9a97);
      cursor: pointer;
      border-radius: 6px 6px 0 0;
      transition: all 0.12s ease;
    }
    
    .upload-tab:hover {
      color: var(--notion-dark, #37352f);
      background: var(--notion-bg-hover, #f7f6f3);
    }
    
    .upload-tab.active {
      color: var(--notion-dark, #37352f);
      background: var(--notion-bg-hover, #f7f6f3);
    }
    
    /* è¡¨å•æ ·å¼ */
    .upload-form {
      display: none;
    }
    
    .upload-form.active {
      display: block;
    }
    
    .form-group {
      margin-bottom: var(--spacing-md, 16px);
    }
    
    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--notion-dark, #37352f);
      margin-bottom: var(--spacing-xs, 4px);
    }
    
    .form-input {
      width: 100%;
      padding: var(--spacing-sm, 8px) var(--spacing-md, 16px);
      border: 1px solid var(--notion-gray-light, #e3e2e0);
      border-radius: 8px;
      font-size: 1rem;
      color: var(--notion-dark, #37352f);
      background: var(--notion-bg, #ffffff);
      transition: border-color 0.12s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--notion-blue, #2383e2);
    }
    
    .form-textarea {
      width: 100%;
      min-height: 200px;
      padding: var(--spacing-md, 16px);
      border: 1px solid var(--notion-gray-light, #e3e2e0);
      border-radius: 8px;
      font-size: 0.95rem;
      color: var(--notion-dark, #37352f);
      background: var(--notion-bg, #ffffff);
      resize: vertical;
      font-family: inherit;
      line-height: 1.6;
      transition: border-color 0.12s ease;
    }
    
    .form-textarea:focus {
      outline: none;
      border-color: var(--notion-blue, #2383e2);
    }
    
    .form-textarea::placeholder {
      color: var(--notion-gray, #9b9a97);
    }
    
    .char-count {
      font-size: 0.75rem;
      color: var(--notion-gray, #9b9a97);
      text-align: right;
      margin-top: var(--spacing-xs, 4px);
    }
    
    .char-count.warning {
      color: var(--notion-orange, #d9730d);
    }
    
    .char-count.error {
      color: var(--notion-red, #e03e3e);
    }
    
    /* æäº¤æŒ‰é’® */
    .submit-btn {
      width: 100%;
      padding: var(--spacing-md, 16px);
      background: var(--notion-black, #191919);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: opacity 0.12s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm, 8px);
    }
    
    .submit-btn:hover:not(:disabled) {
      opacity: 0.85;
    }
    
    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .submit-btn .loading-spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ========== ç´ æåˆ—è¡¨åŒºåŸŸ ========== */
    .materials-list-section {
      background: var(--notion-bg, #ffffff);
      border: 1px solid var(--notion-gray-light, #e3e2e0);
      border-radius: 12px;
      padding: var(--spacing-lg, 24px);
    }
    
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-lg, 24px);
    }
    
    .section-header h2 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--notion-dark, #37352f);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm, 8px);
    }
    
    .refresh-btn {
      background: transparent;
      border: none;
      padding: var(--spacing-xs, 4px) var(--spacing-sm, 8px);
      border-radius: 6px;
      color: var(--notion-gray, #9b9a97);
      cursor: pointer;
      transition: all 0.12s ease;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs, 4px);
      font-size: 0.875rem;
    }
    
    .refresh-btn:hover {
      background: var(--notion-bg-hover, #f7f6f3);
      color: var(--notion-dark, #37352f);
    }
    
    .refresh-btn.refreshing svg {
      animation: spin 1s linear infinite;
    }
    
    /* ç©ºçŠ¶æ€ */
    .empty-state {
      text-align: center;
      padding: var(--spacing-2xl, 64px) var(--spacing-lg, 24px);
      color: var(--notion-gray, #9b9a97);
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: var(--spacing-md, 16px);
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 1rem;
      margin-bottom: var(--spacing-sm, 8px);
    }
    
    .empty-state-hint {
      font-size: 0.875rem;
    }
    
    /* ç´ æå¡ç‰‡åˆ—è¡¨ */
    .materials-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md, 16px);
    }
    
    /* ç´ æå¡ç‰‡ */
    .material-card {
      background: var(--notion-bg, #ffffff);
      border: 1px solid var(--notion-gray-light, #e3e2e0);
      border-radius: 8px;
      padding: var(--spacing-md, 16px);
      transition: all 0.12s ease;
    }
    
    .material-card:hover {
      border-color: var(--notion-gray, #9b9a97);
    }
    
    .material-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--spacing-md, 16px);
      margin-bottom: var(--spacing-sm, 8px);
    }
    
    .material-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--notion-dark, #37352f);
      flex: 1;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .material-status {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs, 4px);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      white-space: nowrap;
    }
    
    .material-status.pending {
      background: var(--notion-bg-hover, #f7f6f3);
      color: var(--notion-gray, #9b9a97);
    }
    
    .material-status.processing {
      background: #e8f4fd;
      color: var(--notion-blue, #2383e2);
    }
    
    .material-status.completed {
      background: #e6f7f4;
      color: var(--notion-green, #0f7b6c);
    }
    
    .material-status.failed {
      background: #fdeaeb;
      color: var(--notion-red, #e03e3e);
    }
    
    .material-meta {
      display: flex;
      align-items: center;
      gap: var(--spacing-md, 16px);
      font-size: 0.75rem;
      color: var(--notion-gray, #9b9a97);
      margin-bottom: var(--spacing-md, 16px);
    }
    
    .material-meta-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs, 4px);
    }
    
    .material-actions {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm, 8px);
      flex-wrap: wrap;
    }
    
    .action-btn {
      padding: var(--spacing-xs, 4px) var(--spacing-md, 16px);
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.12s ease;
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs, 4px);
    }
    
    .action-btn.primary {
      background: var(--notion-black, #191919);
      color: white;
      border: none;
    }
    
    .action-btn.primary:hover {
      opacity: 0.85;
    }
    
    .action-btn.secondary {
      background: transparent;
      color: var(--notion-dark, #37352f);
      border: 1px solid var(--notion-gray-light, #e3e2e0);
    }
    
    .action-btn.secondary:hover {
      background: var(--notion-bg-hover, #f7f6f3);
    }
    
    .action-btn.danger {
      background: transparent;
      color: var(--notion-red, #e03e3e);
      border: 1px solid var(--notion-gray-light, #e3e2e0);
    }
    
    .action-btn.danger:hover {
      background: #fdeaeb;
      border-color: var(--notion-red, #e03e3e);
    }
    
    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* åŠ è½½çŠ¶æ€ */
    .loading-state {
      text-align: center;
      padding: var(--spacing-xl, 40px);
      color: var(--notion-gray, #9b9a97);
    }
    
    .loading-state .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--notion-gray-light, #e3e2e0);
      border-top-color: var(--notion-blue, #2383e2);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto var(--spacing-md, 16px);
    }
    
    /* ========== æç¤ºä¿¡æ¯ ========== */
    .tips-section {
      background: var(--notion-bg-hover, #f7f6f3);
      border-radius: 8px;
      padding: var(--spacing-md, 16px);
      margin-top: var(--spacing-md, 16px);
    }
    
    .tips-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--notion-dark, #37352f);
      margin-bottom: var(--spacing-sm, 8px);
    }
    
    .tips-list {
      font-size: 0.8rem;
      color: var(--notion-gray-dark, #787774);
      line-height: 1.6;
    }
    
    .tips-list li {
      margin-bottom: var(--spacing-xs, 4px);
    }
    
    /* ========== Toast æ¶ˆæ¯ ========== */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--notion-dark, #37352f);
      color: white;
      padding: var(--spacing-md, 16px) var(--spacing-lg, 24px);
      border-radius: 8px;
      font-size: 0.875rem;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    .toast.error {
      background: var(--notion-red, #e03e3e);
    }
    
    .toast.success {
      background: var(--notion-green, #0f7b6c);
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <!-- Header -->
    <header class="header">
      <div class="container">
        <div class="header-content">
          <div class="logo">
            <span class="logo-icon">ğŸ“š</span>
            <span>English Mastery</span>
          </div>
          <div class="header-right">
            <div class="day-badge" id="dayBadge">Day 1 / 30</div>
            <div class="user-menu" id="userMenu">
              <button class="user-btn" onclick="toggleUserDropdown()">
                <span class="user-avatar" id="userAvatar">U</span>
                <span class="user-name" id="userName">ç”¨æˆ·</span>
                <span class="dropdown-arrow">â–¾</span>
              </button>
              <div class="user-dropdown" id="userDropdown">
                <div class="dropdown-header">
                  <span class="dropdown-email" id="userEmail">user@example.com</span>
                </div>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item" onclick="handleLogout()">
                  <span>â†—</span> é€€å‡ºç™»å½•
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
      <div class="container">
        <ul class="nav-list">
          <li class="nav-item">
            <a href="../index.html" class="nav-link">
              <span>â—‰</span> ä»ªè¡¨ç›˜
            </a>
          </li>
          <li class="nav-item">
            <a href="vocabulary.html" class="nav-link">
              <span>â—‡</span> è¯æ±‡å­¦ä¹ 
            </a>
          </li>
          <li class="nav-item">
            <a href="listening.html" class="nav-link">
              <span>â—‡</span> å¬åŠ›è®­ç»ƒ
            </a>
          </li>
          <li class="nav-item">
            <a href="reading.html" class="nav-link">
              <span>â—‡</span> é˜…è¯»ç»ƒä¹ 
            </a>
          </li>
          <li class="nav-item">
            <a href="writing.html" class="nav-link">
              <span>â—‡</span> å†™ä½œç»ƒä¹ 
            </a>
          </li>
          <li class="nav-item">
            <a href="test.html" class="nav-link">
              <span>â—‡</span> æµ‹è¯•è¯„ä¼°
            </a>
          </li>
          <li class="nav-item">
            <a href="calendar.html" class="nav-link">
              <span>â—‡</span> æ‰“å¡æ—¥å†
            </a>
          </li>
          <li class="nav-item">
            <a href="materials.html" class="nav-link active">
              <span>â—†</span> æˆ‘çš„ç´ æ
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <div class="container">
        <h1 style="margin-bottom: var(--spacing-lg, 24px);">ğŸ“‚ æˆ‘çš„å­¦ä¹ ç´ æ</h1>
        <p class="text-muted" style="margin-bottom: var(--spacing-xl, 40px);">
          ä¸Šä¼ ä½ è‡ªå·±çš„è‹±æ–‡ç´ æï¼ŒAI ä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆè¯æ±‡å¡ç‰‡å’Œé˜…è¯»ç†è§£é¢˜ç›®
        </p>
        
        <div class="materials-container">
          <!-- ä¸Šä¼ åŒºåŸŸ -->
          <div class="upload-section">
            <h2>âœ¨ æ·»åŠ æ–°ç´ æ</h2>
            
            <!-- ä¸Šä¼ æ–¹å¼åˆ‡æ¢ -->
            <div class="upload-tabs">
              <button class="upload-tab active" onclick="switchUploadTab('text')">ğŸ“ ç²˜è´´æ–‡æœ¬</button>
              <button class="upload-tab" onclick="switchUploadTab('url')">ğŸ”— ç½‘é¡µé“¾æ¥</button>
            </div>
            
            <!-- æ–‡æœ¬ä¸Šä¼ è¡¨å• -->
            <form id="textForm" class="upload-form active" onsubmit="handleTextSubmit(event)">
              <div class="form-group">
                <label class="form-label" for="textTitle">ç´ ææ ‡é¢˜</label>
                <input type="text" id="textTitle" class="form-input" placeholder="ä¾‹å¦‚ï¼šTEDæ¼”è®² - å­¦ä¹ çš„åŠ›é‡" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="textContent">è‹±æ–‡å†…å®¹</label>
                <textarea id="textContent" class="form-textarea" 
                  placeholder="åœ¨æ­¤ç²˜è´´è‹±æ–‡æ–‡ç« ã€é‚®ä»¶ã€æŠ¥å‘Šç­‰å†…å®¹...&#10;&#10;å»ºè®®å†…å®¹åœ¨ 500-5000 å­—ä¹‹é—´ï¼ŒAI å°†ä»ä¸­æå–ç”Ÿè¯å’Œç”Ÿæˆç†è§£é¢˜ç›®ã€‚"
                  required
                  oninput="updateCharCount(this)"></textarea>
                <div class="char-count" id="textCharCount">0 / 10000 å­—ç¬¦</div>
              </div>
              <button type="submit" class="submit-btn" id="textSubmitBtn">
                <span>å¼€å§‹ç”Ÿæˆå­¦ä¹ å†…å®¹</span>
              </button>
            </form>
            
            <!-- URLä¸Šä¼ è¡¨å• -->
            <form id="urlForm" class="upload-form" onsubmit="handleUrlSubmit(event)">
              <div class="form-group">
                <label class="form-label" for="urlTitle">ç´ ææ ‡é¢˜ï¼ˆå¯é€‰ï¼‰</label>
                <input type="text" id="urlTitle" class="form-input" placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨æå–ç½‘é¡µæ ‡é¢˜">
              </div>
              <div class="form-group">
                <label class="form-label" for="urlInput">ç½‘é¡µé“¾æ¥</label>
                <input type="url" id="urlInput" class="form-input" placeholder="https://..." required>
              </div>
              <button type="submit" class="submit-btn" id="urlSubmitBtn">
                <span>æŠ“å–å¹¶ç”Ÿæˆå­¦ä¹ å†…å®¹</span>
              </button>
            </form>
            
            <!-- æç¤ºä¿¡æ¯ -->
            <div class="tips-section">
              <div class="tips-title">ğŸ’¡ å°è´´å£«</div>
              <ul class="tips-list">
                <li>â€¢ æ¨èä¸Šä¼  500-3000 å­—çš„è‹±æ–‡å†…å®¹</li>
                <li>â€¢ AI ä¼šè‡ªåŠ¨æå– 10-15 ä¸ªæ ¸å¿ƒè¯æ±‡</li>
                <li>â€¢ åŒæ—¶ç”Ÿæˆ 3-5 é“é˜…è¯»ç†è§£é¢˜</li>
                <li>â€¢ æ”¯æŒæ–°é—»ã€åšå®¢ã€é‚®ä»¶ç­‰ä»»æ„è‹±æ–‡æ–‡æœ¬</li>
              </ul>
            </div>
          </div>
          
          <!-- ç´ æåˆ—è¡¨åŒºåŸŸ -->
          <div class="materials-list-section">
            <div class="section-header">
              <h2>ğŸ“š æˆ‘çš„ç´ æåº“</h2>
              <button class="refresh-btn" onclick="refreshMaterials()" id="refreshBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M23 4v6h-6M1 20v-6h6"/>
                  <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                </svg>
                <span>åˆ·æ–°</span>
              </button>
            </div>
            
            <!-- åŠ è½½çŠ¶æ€ -->
            <div class="loading-state" id="loadingState">
              <div class="loading-spinner"></div>
              <div>åŠ è½½ä¸­...</div>
            </div>
            
            <!-- ç©ºçŠ¶æ€ -->
            <div class="empty-state" id="emptyState" style="display: none;">
              <div class="empty-state-icon">ğŸ“­</div>
              <div class="empty-state-text">è¿˜æ²¡æœ‰ä»»ä½•ç´ æ</div>
              <div class="empty-state-hint">åœ¨å·¦ä¾§ä¸Šä¼ ä½ çš„ç¬¬ä¸€ä¸ªå­¦ä¹ ç´ æå§ï¼</div>
            </div>
            
            <!-- ç´ æåˆ—è¡¨ -->
            <div class="materials-list" id="materialsList" style="display: none;">
              <!-- åŠ¨æ€æ¸²æŸ“ -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Scripts -->
  <script src="../js/auth.js"></script>
  <script src="../js/storage.js"></script>
  <script src="../js/materials.js"></script>
  <script>
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    document.addEventListener('DOMContentLoaded', function() {
      if (!Auth.isLoggedIn()) {
        window.location.href = 'auth.html';
        return;
      }
      
      // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
      const user = Auth.getCurrentUser();
      if (user) {
        document.getElementById('userName').textContent = user.name;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
      }
      
      // æ›´æ–°å¤©æ•°
      const currentDay = Storage.getCurrentDay();
      document.getElementById('dayBadge').textContent = `Day ${currentDay} / 30`;
      
      // åŠ è½½ç´ æåˆ—è¡¨
      loadMaterials();
    });
    
    // ç”¨æˆ·èœå•
    function toggleUserDropdown() {
      document.getElementById('userDropdown').classList.toggle('show');
    }
    
    document.addEventListener('click', function(e) {
      const userMenu = document.getElementById('userMenu');
      const dropdown = document.getElementById('userDropdown');
      if (userMenu && !userMenu.contains(e.target)) {
        dropdown.classList.remove('show');
      }
    });
    
    function handleLogout() {
      Auth.logout();
      window.location.href = 'auth.html';
    }
  </script>
</body>
</html>
