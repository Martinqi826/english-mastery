<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯•è¯„ä¼° - English Mastery</title>
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    .test-card { background: var(--bg-primary); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-lg); box-shadow: var(--shadow-md); }
    .question-number { font-size: 0.875rem; color: var(--text-muted); margin-bottom: var(--spacing-sm); }
    .question-text { font-size: 1.125rem; font-weight: 500; margin-bottom: var(--spacing-lg); }
    .options-list { display: flex; flex-direction: column; gap: var(--spacing-sm); }
    .option-item { padding: var(--spacing-md); border: 1px solid var(--border-color); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; }
    .option-item:hover { border-color: var(--primary-color); background: var(--bg-tertiary); }
    .option-item.selected { border-color: var(--primary-color); background: var(--primary-light); color: white; }
    .option-item.correct { border-color: var(--success-color); background: var(--success-color); color: white; }
    .option-item.wrong { border-color: var(--danger-color); background: var(--danger-color); color: white; }
    .test-progress { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); }
    .progress-dots { display: flex; gap: var(--spacing-xs); }
    .progress-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--border-color); }
    .progress-dot.current { background: var(--primary-color); }
    .progress-dot.answered { background: var(--success-color); }
    .result-card { text-align: center; padding: var(--spacing-2xl); }
    .result-score { font-size: 4rem; font-weight: 700; color: var(--primary-color); }
    .result-label { font-size: 1.25rem; color: var(--text-muted); margin-top: var(--spacing-sm); }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <header class="header"><div class="container"><div class="header-content"><div class="logo"><span class="logo-icon">ğŸ¯</span><span>English Mastery</span></div><div class="day-badge" id="dayBadge">Day 1 / 30</div></div></div></header>
    <nav class="nav"><div class="container"><ul class="nav-list">
      <li class="nav-item"><a href="../index.html" class="nav-link"><span>â—‰</span> ä»ªè¡¨ç›˜</a></li>
      <li class="nav-item"><a href="vocabulary.html" class="nav-link"><span>â—‡</span> è¯æ±‡å­¦ä¹ </a></li>
      <li class="nav-item"><a href="listening.html" class="nav-link"><span>â—‡</span> å¬åŠ›è®­ç»ƒ</a></li>
      <li class="nav-item"><a href="reading.html" class="nav-link"><span>â—‡</span> é˜…è¯»ç»ƒä¹ </a></li>
      <li class="nav-item"><a href="writing.html" class="nav-link"><span>â—‡</span> å†™ä½œç»ƒä¹ </a></li>
      <li class="nav-item"><a href="test.html" class="nav-link active"><span>â—†</span> æµ‹è¯•è¯„ä¼°</a></li>
      <li class="nav-item"><a href="calendar.html" class="nav-link"><span>â—‡</span> æ‰“å¡æ—¥å†</a></li>
      <li class="nav-item"><a href="materials.html" class="nav-link"><span>â—‡</span> æˆ‘çš„ç´ æ</a></li>
    </ul></div></nav>
    <main class="main-content">
      <div class="container">
        <h1 style="margin-bottom: var(--spacing-lg);">ğŸ¯ æ¯æ—¥æµ‹éªŒ</h1>
        <div class="test-card" id="testCard">
          <div class="test-progress">
            <span id="questionProgress">ç¬¬ 1 é¢˜ / å…± 5 é¢˜</span>
            <div class="progress-dots" id="progressDots"></div>
          </div>
          <div class="question-number" id="questionNumber">Question 1</div>
          <div class="question-text" id="questionText">Loading...</div>
          <div class="options-list" id="optionsList"></div>
          <div style="margin-top: var(--spacing-xl); text-align: center;">
            <button class="btn btn-primary btn-lg" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
          </div>
        </div>
        <div class="test-card hidden" id="resultCard">
          <div class="result-card">
            <div style="font-size: 4rem; margin-bottom: var(--spacing-lg);">ğŸ‰</div>
            <div class="result-score" id="resultScore">0%</div>
            <div class="result-label">æ­£ç¡®ç‡</div>
            <p class="text-muted mt-lg" id="resultMessage">ç»§ç»­åŠ æ²¹ï¼</p>
            <button class="btn btn-primary btn-lg mt-xl" onclick="location.href='../index.html'">è¿”å›ä»ªè¡¨ç›˜</button>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script src="../js/storage.js"></script>
  <script>
    const questions = [
      { question: "What does 'agenda' mean?", options: ["æ—¥ç¨‹è¡¨", "ä»£ç†äºº", "å†œä¸š", "å¹´é¾„"], correct: 0 },
      { question: "Choose the correct word: 'We need to ___ the new policy.'", options: ["implement", "important", "import", "impose"], correct: 0 },
      { question: "'Collaborate' means:", options: ["å´©æºƒ", "æ”¶é›†", "åˆä½œ", "åº†ç¥"], correct: 2 },
      { question: "What is a 'stakeholder'?", options: ["ç‰›æ’æŒæœ‰è€…", "åˆ©ç›Šç›¸å…³è€…", "èµŒå¾’", "è‚¡ç¥¨"], correct: 1 },
      { question: "'Streamline' in business means:", options: ["æºªæµ", "ç²¾ç®€æµç¨‹", "ç›´çº¿", "è’¸æ±½"], correct: 1 }
    ];
    let currentQuestion = 0;
    let answers = [];
    let correctCount = 0;
    
    document.addEventListener('DOMContentLoaded', function() {
      const currentDay = Storage.getCurrentDay();
      document.getElementById('dayBadge').textContent = `Day ${currentDay} / 30`;
      renderProgressDots();
      showQuestion();
    });
    
    function renderProgressDots() {
      const dots = document.getElementById('progressDots');
      dots.innerHTML = questions.map((_, i) => `<div class="progress-dot" id="dot-${i}"></div>`).join('');
    }
    
    function showQuestion() {
      const q = questions[currentQuestion];
      document.getElementById('questionProgress').textContent = `ç¬¬ ${currentQuestion + 1} é¢˜ / å…± ${questions.length} é¢˜`;
      document.getElementById('questionNumber').textContent = `Question ${currentQuestion + 1}`;
      document.getElementById('questionText').textContent = q.question;
      document.getElementById('optionsList').innerHTML = q.options.map((opt, i) => 
        `<div class="option-item" onclick="selectOption(${i})">${String.fromCharCode(65 + i)}. ${opt}</div>`
      ).join('');
      document.getElementById(`dot-${currentQuestion}`).classList.add('current');
    }
    
    function selectOption(index) {
      answers[currentQuestion] = index;
      document.querySelectorAll('.option-item').forEach((opt, i) => {
        opt.classList.toggle('selected', i === index);
      });
    }
    
    function nextQuestion() {
      if (answers[currentQuestion] === undefined) { alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ'); return; }
      
      const q = questions[currentQuestion];
      if (answers[currentQuestion] === q.correct) correctCount++;
      
      document.getElementById(`dot-${currentQuestion}`).classList.remove('current');
      document.getElementById(`dot-${currentQuestion}`).classList.add('answered');
      
      currentQuestion++;
      if (currentQuestion < questions.length) {
        showQuestion();
      } else {
        showResult();
      }
    }
    
    function showResult() {
      const accuracy = Math.round((correctCount / questions.length) * 100);
      document.getElementById('testCard').classList.add('hidden');
      document.getElementById('resultCard').classList.remove('hidden');
      document.getElementById('resultScore').textContent = accuracy + '%';
      document.getElementById('resultMessage').textContent = accuracy >= 80 ? 'å¤ªæ£’äº†ï¼' : accuracy >= 60 ? 'è¿˜ä¸é”™ï¼' : 'ç»§ç»­åŠªåŠ›ï¼';
      
      Storage.updateTodayTask('test', true);
      Storage.addStudyTime(10);
      const progress = Storage.getProgress();
      ['vocabulary', 'listening', 'reading', 'writing', 'speaking'].forEach(skill => {
        progress[skill] = Math.min(100, (progress[skill] || 30) + 0.5);
      });
      progress.overall = Storage.calculateOverallProgress(progress);
      Storage.setProgress(progress);
    }
  </script>
</body>
</html>
